function drawTrack(){$.post("../getTrackData",{user:user}).done(function(t){var a=t.songs,n=t.plays,e=t.colors,r=d3.range(25).map(function(t){return{x1:0,y1:0,x2:0,y2:480}}),i=r.map(function(t,a){return a>0?10*a:0===a?"100":void 0}),l=d3.scale.linear().domain([0,n[0]]).range([0,722]),s=d3.scale.linear().domain([0,a.length]).range([0,480]),d=d3.scale.quantize().domain([0,a.length]).range(e)
$("#visualization").html("")
var o=d3.select("#visualization").append("svg").attr({width:1200,height:700}),c=(o.append("g").attr("id","grid").attr("transform","translate(500,140)").selectAll("line").data(r).enter().append("line").attr({x1:function(t,a){return 30*a},y1:function(t){return t.y1},x2:function(t,a){return 30*a},y2:function(t){return t.y2}}).style({stroke:"#adadad","stroke-width":"1px"}),d3.svg.axis())
c.orient("bottom").scale(l).tickValues(i)
var u=d3.svg.axis()
u.orient("left").scale(s).tickSize(2).tickFormat(function(t,n){return a[n]}).tickValues(d3.range(17))
o.append("g").attr("transform","translate(500,130)").attr("id","yaxis").call(u),o.append("g").attr("transform","translate(500,610)").attr("id","xaxis").call(c),o.append("g").attr("transform","translate(500,100)").attr("id","bars").selectAll("rect").data(n).enter().append("rect").attr("height",19).attr({x:0,y:function(t,a){return s(a)+19}}).style("fill",function(t,a){return d(a)}).attr("width",function(t){return 0}),d3.select("svg").selectAll("rect").data(n).transition().duration(1e3).attr("width",function(t){return l(t)}),d3.select("#bars").selectAll("text").data(n).enter().append("text").attr({x:function(t){return l(t)-100},y:function(t,a){return s(a)+35}}).text(function(t){return t}).style({fill:"#fff","font-size":"14px"})})}