// //A little hack to open up the spotify trackset window without loosing focus
// if (window.name != "final"){
//  var url = window.location.href;
//  var newWin = window.open(url,"final");
//  if(!newWin || newWin.closed || typeof newWin.closed=='undefined'){
//      //This breaks down quickly with popup blockers
//      newWin = undefined;
//      alert("Please disable your popup blocker to enjoy Webtunes. We promise to be responsible!");
//  }else{
//      window.location = "https://play.spotify.com/trackset";
//  }
// }
//Client side js for customPage
//handler to fade between views nicely
//Searches for and displays all music matching the key in the search box
//Sorts the users library according to there sorting choice
//This is used to switch between displaying all songs and only playable ones
//Populates library view with given tracks
//handler to expand an album when its clicked on
//Code to close up the spotify player
//Funciton to expand a chosen song
//Loads provided data into visual player
//Plays individual track when already within an album
//Plays a full album
var albums,songs,user,expanded=!1,viewToRestore,lastKey="",sortBy="title",playableOnly=!1
$(document).ready(function(){$("#search").keyup(search),$("#search").on("search",search),$("#searchForm").submit(function(a){return a.preventDefault(),!1}),$(".navDiv").on("click",switchMode),$(".albumCont").on("click",expandAlbum),$(".song").on("click",expandSong),$("#closeBar").on("click",closePlayer),$("#albWrapper").on("click",playFull),$(".sorter").on("click",sort),$(".playCol").on("click",togglePlayable)})
var switchMode=function(){var a=$(this).attr("data-cont")
$(".navDiv").each(function(){a!=$(this).attr("data-cont")?($(this).removeClass("highlighted").addClass("normal"),$($(this).attr("data-cont")).fadeOut()):($(this).addClass("highlighted").removeClass("normal"),$($(this).attr("data-cont")).fadeIn())})},search=function(){var a=$("#search").val()
lastKey=a
var t
t=""===lastKey?"":"/"+lastKey,$.get("../../musicSearchAndSort/"+user+t+"/"+sortBy,function(t){if(lastKey==a){populateLib(t[0],playableOnly),songs=t[0],$(".albumCont").remove(),albums=t[1]
for(var e=0;e<t[1].length;e++){var r=$('<div class="albumCont" data-albumnum="'+e+'"></div')
r.append($('<img class="albCover"src="'+t[1][e][0].art_md+'">')),r.append($('<p class="albTitle">'+t[1][e][0].album+"</p>")),r.append($('<p class="albArtist"> -'+t[1][e][0].artist+"</p>")),$("#albumView").append(r)}$(".albumCont").on("click",expandAlbum)}})},sort=function(){$(".sorter").removeClass("highlighted"),$(this).addClass("highlighted"),sortBy=$(this).text().toLowerCase()
var a
a=""===lastKey?"":"/"+lastKey,$.get("../../musicSearchAndSort/"+user+a+"/"+sortBy,function(a){songs=a[0],populateLib(a[0],playableOnly)})},togglePlayable=function(){playableOnly=!playableOnly,populateLib(songs,playableOnly)},populateLib=function(a,t){$(".song").remove()
for(var e=0,r=0;r<a.length;r++)if("-"==a[r].track_id&&t)e++
else{var l=""
l=(r-e)%2===0?"even":"odd"
var s=$('<tr data-num="'+r+'" data-id="'+a[r].track_id+'" class="song '+l+'"></tr>')
s.append($('<td class="title">'+a[r].title+"</td>")),s.append($('<td class="album">'+a[r].album+"</td>")),s.append($('<td class="artist">'+a[r].artist+"</td>")),s.append($('<td class="playcount">'+a[r].playcount+"</td>"))
var n
n="-"==a[r].track_id?"notplayable":"playable",s.append($('<td class="'+n+'"></td>')),$("#songView").append(s)}$(".song").on("click",expandSong)},expandAlbum=function(){if(!expanded){expanded=!0
for(var a=this,t=albums[$(a).data("albumnum")],e="https://open.spotify.com/embed/album/"+t[0].album_id,r=0;r<t.length;r++)$("#trackList").append('<li class="track hover" data-id="'+t[r].track_id+'"data-title="'+t[r].title+'"data-artist="'+t[r].artist+'" data-num='+r+'><img class="trkImg" src="../images/play_button.png"/>  '+t[r].title+" - "+t[r].artist+"</li>")
$("#albWrapper").addClass("hover"),displayPlayer([t[0].art_lg,t[0].album,t[0].artist],$("#albumView")),$("#albWrapper").attr("data-album-embed",e),$(".track").on("click",playTrack)}},closePlayer=function(){$("#bg").fadeOut(),$("#overlay").fadeOut(400,function(){$("#header").fadeIn(),viewToRestore.fadeIn(),$(".track").remove(),$("iframe").remove()}),expanded=!1},expandSong=function(){if(!expanded){expanded=!0
var a=parseInt($(this).attr("data-num"),10)
if(displayPlayer([songs[a].art_lg,songs[a].title,songs[a].artist],$("#songView")),$("#albWrapper").removeClass("hover"),"-"!==$(this).attr("data-id")){var t="https://open.spotify.com/embed/track/"+$(this).attr("data-id")
$("iframe").remove()
var e=$('<iframe frameborder="0" allowtransparency="true" src="'+t+'"></iframe>')
$("#overlay").append(e)}}},displayPlayer=function(a,t){viewToRestore=t,""!==a[0]&&($("#bg").css("background-image","url("+a[0]+")"),$("#bigAlb").attr("src",a[0])),$("#songAlbum").text(a[1]),$("#songArtist").text(a[2]),$("#header").fadeOut(),viewToRestore.fadeOut(400,function(){$("#bg").fadeIn(),$("#overlay").fadeIn()})},playTrack=function(){if(displayPlayer(["",$(this).attr("data-title"),$(this).attr("data-artist")],$("#albumView")),$(".track").fadeOut(),"-"!=$(this).attr("data-id")){var a="https://open.spotify.com/embed/track/"+$(this).attr("data-id")
$("iframe").remove()
var t=$('<iframe frameborder="0" allowtransparency="true" src="'+a+'"></iframe>')
$("#overlay").append(t)}$("#albWrapper").removeClass("hover")},playFull=function(){$("iframe").remove()
var a=$('<iframe frameborder="0" allowtransparency="true" src="'+$(this).attr("data-album-embed")+'"></iframe>')
$("#overlay").append(a)}
